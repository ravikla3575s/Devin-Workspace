# 保険請求管理システム テスト手順書

このドキュメントでは、保険請求管理システムの新機能をテストするための手順を説明します。

## 1. シート3（まとめシート）機能のテスト

### テスト準備
1. テンプレートと保存先フォルダを設定
2. CSVファイルを含むフォルダを用意（fixf, fmei, henr, zognファイルを含む）

### テスト手順
1. メニューから「CSVファイルから報告書作成」を選択
2. CSVフォルダを選択し、処理を実行
3. 生成されたレポートファイルを開き、以下を確認:
   - 「まとめ」シートが作成されていること
   - 社保セクションに未請求、返戻、減点の件数と金額が表示されていること
   - 国保セクションに未請求、返戻、減点の件数と金額が表示されていること
   - 総合計セクションに全体の合計が正しく計算されていること
   - 各セクションの合計行が正しく計算されていること

### 期待結果
- まとめシートが正しく作成され、詳細シートのデータが適切に集計されている
- 社保/国保の区分が正しく行われている
- 金額の書式設定が適切に行われている

## 2. 半期売掛金繰越額計算機能のテスト

### テスト準備
1. 複数月分のレポートファイルを保存先フォルダに用意（上期：4-9月、下期：10-3月）

### テスト手順
1. メニューから「半期売掛金繰越額計算」を選択
2. 対象年度（例：2025）を入力
3. 対象期間（上期/下期）を選択
4. レポートフォルダを選択
5. 生成された売掛金繰越額計算レポートを確認:
   - 各月のデータが正しく抽出されていること
   - 未請求、返戻、減点の金額が正しく転記されていること
   - 合計行が正しく計算されていること

### 期待結果
- 対象期間のレポートファイルが正しく識別されている
- 各月のデータが正しく抽出されている
- 合計が正しく計算されている
- レポートの書式設定が適切に行われている

## 3. 請求誤差追求報告書機能のテスト

### テスト準備
1. 減点・査定データを含むレポートファイルを保存先フォルダに用意

### テスト手順
1. メニューから「請求誤差追求報告書作成」を選択
2. 対象年（例：2025）を入力
3. 対象月（例：4）を入力
4. レポートフォルダを選択
5. 生成された請求誤差追求報告書を確認:
   - 減点・査定データが正しく抽出されていること
   - 請求点数と実績点数が正しく計算されていること
   - 差異が正しく計算されていること
   - 原因と対策の列が用意されていること

### 期待結果
- 対象月のレポートファイルが正しく識別されている
- 減点・査定データのみが抽出されている
- 請求点数、実績点数、差異が正しく計算されている
- レポートの書式設定が適切に行われている

## 4. データベースシート機能のテスト

### テスト準備
1. テンプレートと保存先フォルダを設定
2. CSVファイルを含むフォルダを用意（fixf, fmei, henr, zognファイルを含む）
3. 報告書を作成し、まとめシートが生成されていることを確認

### テスト手順
1. メニューから「データベース機能」→「データベース作成・更新」を選択
2. データベースシートが作成されることを確認
3. 以下を確認:
   - 全レコードが正しく表示されていること
   - 各列（ID、区分、患者名、調剤年月、医療機関、【請求】請求日、【請求】処理日、【請求】返戻日、【請求】請求先機関、【請求】主保険請求額、【請求】公費請求額、【再請求】再請求日、【再請求】再請求先機関、【再請求】主保険再請求額、【再請求】公費再請求額、備考）が正しく設定されていること
   - 請求時と再請求時の情報が色分けされて表示されていること
   - フィルター機能が有効になっていること

### 期待結果
- データベースシートが正しく作成され、詳細シートのデータが適切に集計されている
- 各列のデータが正しく分類されている
- フィルター機能が正しく設定されている

## 5. データベース検索・フィルタリング機能のテスト

### テスト準備
1. データベースシートが作成されていることを確認

### テスト手順
1. メニューから「データベース機能」→「データベース検索・フィルタリング」を選択
2. 検索フォームで以下の条件を設定:
   - 区分: 「未請求」を選択
   - 患者名: 患者名の一部を入力
3. 「検索」ボタンをクリックし、検索結果が条件に合致していることを確認
4. 別の条件で検索を実行し、結果が正しく表示されることを確認:
   - 金額範囲を指定
   - 調剤年月の日付範囲を指定
   - 請求日の範囲を指定
   - 処理日の範囲を指定
   - 返戻日の範囲を指定
   - 再請求日の範囲を指定
   - 主保険請求額の範囲を指定
   - 公費請求額の範囲を指定
   - 主保険再請求額の範囲を指定
   - 公費再請求額の範囲を指定
   - 請求先機関を指定
   - 再請求先機関を指定
   - 複数の条件を組み合わせる

### 期待結果
- 検索フォームが正しく表示される
- 検索条件に合致するレコードのみが表示される
- 検索結果の件数が正しく表示される
- フィルターが正しく適用される

## 6. データベースCSV出力機能のテスト

### テスト準備
1. データベースシートが作成されていることを確認
2. 必要に応じて検索・フィルタリングを適用

### テスト手順
1. メニューから「データベース機能」→「データベースCSV出力」を選択
2. 保存先を選択し、CSVファイルが正常に作成されることを確認
3. エクスポートされたCSVファイルを開き、以下を確認:
   - データが正しくエクスポートされていること
   - フィルタリングされたデータのみがエクスポートされていること（フィルターを適用した場合）
   - 文字コードが正しく設定されていること

### 期待結果
- CSVファイルが正常に作成される
- データが正しくエクスポートされる
- 日本語が正しく表示される

## 7. データベース集計レポート機能のテスト

### テスト準備
1. データベースシートが作成されていることを確認
2. 必要に応じて検索・フィルタリングを適用

### テスト手順
1. メニューから「データベース機能」→「データベース集計レポート作成」を選択
2. 集計レポートシートが作成されることを確認
3. 以下を確認:
   - 請求先別集計が正しく表示されていること（件数フィールドなし）
   - 区分別集計が正しく表示されていること（件数フィールドなし）
   - 月別集計が正しく表示されていること
   - 請求時と再請求時の情報が分けて表示されていること
   - 各集計の合計が正しく計算されていること

### 期待結果
- 集計レポートシートが正しく作成される
- 各集計が正しく計算される
- 書式設定が適切に行われている

## 8. メニュー統合のテスト

### テスト手順
1. ワークブックを開き、メニューバーに「保険請求管理」メニューが表示されることを確認
2. 各メニュー項目をクリックし、対応する機能が起動することを確認:
   - CSVファイルから報告書作成
   - テンプレート・保存先設定
   - まとめシート更新
   - 半期売掛金繰越額計算
   - 請求誤差追求報告書作成
   - データベース機能（サブメニュー）
     - データベース作成・更新
     - データベース検索・フィルタリング
     - データベースCSV出力
     - データベース集計レポート作成
   - ヘルプ

### 期待結果
- メニューが正しく表示されている
- 各メニュー項目が対応する機能を正しく呼び出している
- データベース機能のサブメニューが正しく表示され、機能が正しく呼び出される
- ヘルプが正しく表示されている

## 9. エラー処理のテスト

### テスト手順
1. 各機能で以下のエラーケースをテスト:
   - 必要なファイルが存在しない場合
   - 無効なデータが含まれる場合
   - ユーザーがキャンセルした場合
   - 対象期間のファイルが見つからない場合
   - データベースシートが存在しない状態でデータベース機能を使用した場合

### 期待結果
- 適切なエラーメッセージが表示される
- プログラムがクラッシュせず、エラー後も正常に動作する
- ユーザーがキャンセルした場合、処理が適切に中断される
- データベースシートが存在しない場合、適切なメッセージが表示され、必要に応じてシートが作成される
